{% extends 'base.html' %}
{% load static %}

{% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∞{% endblock %}

{% block extra_scripts %}
<script>
// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–∞
function updateFontSize(newSize) {
    const body = document.body;
    body.classList.remove('font-small', 'font-large', 'font-xlarge');
    
    switch(newSize) {
        case 'small':
            body.classList.add('font-small');
            break;
        case 'large':
            body.classList.add('font-large');
            break;
        case 'xlarge':
            body.classList.add('font-xlarge');
            break;
        default:
            // normal size, no additional class needed
    }
    
    localStorage.setItem('fontSize', newSize);
}

// –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
document.addEventListener('DOMContentLoaded', function() {
    const savedFontSize = localStorage.getItem('fontSize') || 'normal';
    
    updateFontSize(savedFontSize);
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–∞
    const fontSizeInputs = document.querySelectorAll('input[name="font_size"]');
    fontSizeInputs.forEach(input => {
        input.addEventListener('change', function() {
            updateFontSize(this.value);
        });
    });
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
document.getElementById('settings-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const theme = formData.get('theme');
    const fontSize = formData.get('font_size');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–º—É –∏ —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
    updateTheme(theme);
    updateFontSize(fontSize);
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
    fetch(this.action, {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        showMessage('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
    })
    .catch(error => {
        console.error('Error:', error);
        showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫', 'danger');
    });
});

function showMessage(message, type) {
    // –°–æ–∑–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
    alertDiv.role = 'alert';
    alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    `;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
    const messagesContainer = document.querySelector('.messages-container');
    if (messagesContainer) {
        messagesContainer.appendChild(alertDiv);
    } else {
        // –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –µ–≥–æ
        const body = document.querySelector('main');
        const container = document.createElement('div');
        container.className = 'messages-container';
        container.appendChild(alertDiv);
        body.insertBefore(container, body.firstChild);
    }
}
</script>
{% endblock %}

{% block content %}
<div class="container">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a></li>
            <li class="breadcrumb-item"><a href="{% url 'miscellaneous' %}">üîß –†–∞–∑–Ω–æ–µ</a></li>
            <li class="breadcrumb-item active" aria-current="page">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞</li>
        </ol>
    </nav>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞</h1>
        <div class="btn-group">
            <a href="{% url 'miscellaneous' %}" class="btn btn-outline-secondary">
                ‚Üê –ù–∞–∑–∞–¥
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8 mx-auto">
            <div class="card">
                <div class="card-header">
                    <h3 class="mb-0">üîß –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                </div>
                <div class="card-body">
                    <form method="post" id="settings-form">
                        {% csrf_token %}
                        
                        <div class="mb-4">
                            <h5>üî§ –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h5>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="language" id="lang_ru" value="ru" {% if language == 'ru' %}checked{% endif %}>
                                <label class="form-check-label" for="lang_ru">
                                    üá∑üá∫ –†—É—Å—Å–∫–∏–π
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="language" id="lang_en" value="en" {% if language == 'en' %}checked{% endif %}>
                                <label class="form-check-label" for="lang_en">
                                    üá¨üáß English
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h5>üìè –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞</h5>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="font_size" id="size_small" value="small" {% if font_size == 'small' %}checked{% endif %}>
                                <label class="form-check-label" for="size_small">
                                    –ú–∞–ª–µ–Ω—å–∫–∏–π —à—Ä–∏—Ñ—Ç
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="font_size" id="size_normal" value="normal" {% if font_size == 'normal' %}checked{% endif %}>
                                <label class="form-check-label" for="size_normal">
                                    –û–±—ã—á–Ω—ã–π —à—Ä–∏—Ñ—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="font_size" id="size_large" value="large" {% if font_size == 'large' %}checked{% endif %}>
                                <label class="form-check-label" for="size_large">
                                    –ë–æ–ª—å—à–æ–π —à—Ä–∏—Ñ—Ç
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="font_size" id="size_xlarge" value="xlarge" {% if font_size == 'xlarge' %}checked{% endif %}>
                                <label class="form-check-label" for="size_xlarge">
                                    –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π —à—Ä–∏—Ñ—Ç
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h5>üé® –¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</h5>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="theme" id="theme_light" value="light" {% if theme == 'light' %}checked{% endif %}>
                                <label class="form-check-label" for="theme_light">
                                    –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="theme" id="theme_dark" value="dark" {% if theme == 'dark' %}checked{% endif %}>
                                <label class="form-check-label" for="theme_dark">
                                    –¢–µ–º–Ω–∞—è —Ç–µ–º–∞
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h5>üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h5>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="notifications_email" checked>
                                <label class="form-check-label" for="notifications_email">
                                    Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="notifications_system" checked>
                                <label class="form-check-label" for="notifications_system">
                                    –°–∏—Å—Ç–µ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                                </label>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button type="submit" class="btn btn-primary">
                                ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                            </button>
                            <a href="{% url 'settings' %}" class="btn btn-outline-secondary">
                                –°–±—Ä–æ—Å–∏—Ç—å
                            </a>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö</h5>
                </div>
                <div class="card-body">
                    <ul class="small">
                        <li>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Å–µ—Å—Å–∏–∏ –∏ –¥–µ–π—Å—Ç–≤—É—é—Ç –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–µ–∞–Ω—Å–∞</li>
                        <li>–ò–∑–º–µ–Ω–µ–Ω–∏–µ —è–∑—ã–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ</li>
                        <li>–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</li>
                        <li>–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –≤–ª–∏—è–µ—Ç –Ω–∞ —Ü–≤–µ—Ç–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</li>
                        <li>–î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –æ—Å–Ω–æ–≤–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}