{% extends 'base.html' %}
{% load static %}

{% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∞{% endblock %}

{% block content %}
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞</h1>
        <div class="btn-group">
            <a href="{% url 'miscellaneous' %}" class="btn btn-outline-secondary">
                ‚Üê –ù–∞–∑–∞–¥
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8 mx-auto">
            <div class="card">
                <div class="card-header">
                    <h3 class="mb-0">üîß –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                </div>
                <div class="card-body">
                    <form method="post" id="settings-form" action="{% url 'settings' %}">
                        {% csrf_token %}
                        
                        <div class="mb-4">
                            <h5>üî§ –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h5>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="language" id="lang_ru" 
                                       value="ru" {% if language == 'ru' %}checked{% endif %}>
                                <label class="form-check-label" for="lang_ru">
                                    üá∑üá∫ –†—É—Å—Å–∫–∏–π
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="language" id="lang_en" 
                                       value="en" {% if language == 'en' %}checked{% endif %}>
                                <label class="form-check-label" for="lang_en">
                                    üá¨üáß English
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h5>üìè –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞</h5>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="font_size" id="size_small" 
                                       value="small" {% if font_size == 'small' %}checked{% endif %}>
                                <label class="form-check-label" for="size_small">
                                    –ú–∞–ª–µ–Ω—å–∫–∏–π —à—Ä–∏—Ñ—Ç
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="font_size" id="size_normal" 
                                       value="normal" {% if font_size == 'normal' %}checked{% endif %}>
                                <label class="form-check-label" for="size_normal">
                                    –û–±—ã—á–Ω—ã–π —à—Ä–∏—Ñ—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="font_size" id="size_large" 
                                       value="large" {% if font_size == 'large' %}checked{% endif %}>
                                <label class="form-check-label" for="size_large">
                                    –ë–æ–ª—å—à–æ–π —à—Ä–∏—Ñ—Ç
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="font_size" id="size_xlarge" 
                                       value="xlarge" {% if font_size == 'xlarge' %}checked{% endif %}>
                                <label class="form-check-label" for="size_xlarge">
                                    –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π —à—Ä–∏—Ñ—Ç
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h5>üé® –¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</h5>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="theme" id="theme_light" 
                                       value="light" {% if theme == 'light' %}checked{% endif %}
                                       onchange="handleThemeChange(this)">
                                <label class="form-check-label" for="theme_light">
                                    <i class="bi bi-sun"></i> –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="theme" id="theme_dark" 
                                       value="dark" {% if theme == 'dark' %}checked{% endif %}
                                       onchange="handleThemeChange(this)">
                                <label class="form-check-label" for="theme_dark">
                                    <i class="bi bi-moon"></i> –¢–µ–º–Ω–∞—è —Ç–µ–º–∞
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h5>üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h5>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="notifications_email" 
                                       id="notifications_email" {% if notifications_email %}checked{% endif %}>
                                <label class="form-check-label" for="notifications_email">
                                    Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="notifications_system" 
                                       id="notifications_system" {% if notifications_system %}checked{% endif %}>
                                <label class="form-check-label" for="notifications_system">
                                    –°–∏—Å—Ç–µ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                                </label>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button type="button" class="btn btn-outline-secondary" onclick="resetSettings()">
                                –°–±—Ä–æ—Å–∏—Ç—å
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö</h5>
                </div>
                <div class="card-body">
                    <ul class="small">
                        <li>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Å–µ—Å—Å–∏–∏ –∏ –¥–µ–π—Å—Ç–≤—É—é—Ç –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–µ–∞–Ω—Å–∞</li>
                        <li>–ò–∑–º–µ–Ω–µ–Ω–∏–µ —è–∑—ã–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ</li>
                        <li>–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</li>
                        <li>–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –≤–ª–∏—è–µ—Ç –Ω–∞ —Ü–≤–µ—Ç–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</li>
                        <li>–î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –æ—Å–Ω–æ–≤–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

document.addEventListener('DOMContentLoaded', function() {
    const savedFontSize = localStorage.getItem('fontSize') || 'normal';
    const savedTheme = localStorage.getItem('theme') || 'light';
    
    const savedFontSizeInput = document.querySelector(`input[name="font_size"][value="${savedFontSize}"]`);
    const savedThemeInput = document.querySelector(`input[name="theme"][value="${savedTheme}"]`);
    
    if (savedFontSizeInput) savedFontSizeInput.checked = true;
    if (savedThemeInput) savedThemeInput.checked = true;
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º—ã –≤ —Ñ–æ—Ä–º–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
    const themeInputs = document.querySelectorAll('input[name="theme"]');
    themeInputs.forEach(input => {
        input.addEventListener('change', function() {
            const newTheme = this.value;
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ base.html
            updateTheme(newTheme);
            saveThemeToServer(newTheme);
        });
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–∞
    const fontSizeInputs = document.querySelectorAll('input[name="font_size"]');
    fontSizeInputs.forEach(input => {
        input.addEventListener('change', function() {
            const newSize = this.value;
            updateFontSize(newSize);
        });
    });
});

function handleThemeChange(radio) {
    if (radio.checked) {
        const newTheme = radio.value;
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É –±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        updateTheme(newTheme);
        saveThemeToServer(newTheme);
    }
}

function resetSettings() {
    // –°–±—Ä–æ—Å –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    document.querySelector('input[name="language"][value="ru"]').checked = true;
    document.querySelector('input[name="font_size"][value="normal"]').checked = true;
    document.querySelector('input[name="theme"][value="light"]').checked = true;
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–±—Ä–æ—à–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    updateTheme('light');
    updateFontSize('normal');
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
    const formData = new FormData(document.getElementById('settings-form'));
    formData.set('language', 'ru');
    formData.set('font_size', 'normal');
    formData.set('theme', 'light');
    
    fetch('{% url 'settings' %}', {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        showMessage('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é!', 'success');
    })
    .catch(error => {
        console.error('Error:', error);
        showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫', 'danger');
    });
}
</script>
{% endblock %}