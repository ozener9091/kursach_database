<!-- templates/core/table_list.html -->
{% extends 'base.html' %}
{% load core_extras %}

{% block title %}{{ table_title }}{% endblock %}

{% block content %}
<div class="container">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a></li>
            <li class="breadcrumb-item">
                {% if user.groups.first.name == '–î–∏—Ä–µ–∫—Ç–æ—Ä' %}
                <a href="{% url 'director_tables' %}">–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã</a>
                {% elif user.groups.first.name == '–ú–µ–Ω–µ–¥–∂–µ—Ä' %}
                <a href="{% url 'manager_tables' %}">–¢–∞–±–ª–∏—Ü—ã –º–µ–Ω–µ–¥–∂–µ—Ä–∞</a>
                {% elif user.groups.first.name == '–®–µ—Ñ-–ø–æ–≤–∞—Ä' %}
                <a href="{% url 'chef_tables' %}">–¢–∞–±–ª–∏—Ü—ã —à–µ—Ñ-–ø–æ–≤–∞—Ä–∞</a>
                {% elif user.groups.first.name == '–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –∫–∞–¥—Ä–∞–º' %}
                <a href="{% url 'hr_tables' %}">–¢–∞–±–ª–∏—Ü—ã HR</a>
                {% endif %}
            </li>
            <li class="breadcrumb-item active" aria-current="page">{{ table_title }}</li>
        </ol>
    </nav>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="mb-1">{{ table_title }}</h1>
            <p class="text-muted mb-0">
                –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: <strong>{{ page_obj.paginator.count }}</strong>
                {% if page_obj.paginator.num_pages > 1 %}
                | –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
                {% endif %}
            </p>
        </div>
        <div class="btn-group">
            {% if has_add_permission %}
            <a href="{% url 'admin:core_'|add:model_name|add:'_add' %}" class="btn btn-success">
                ‚ûï –î–æ–±–∞–≤–∏—Ç—å
            </a>
            {% endif %}
            <a href="
                {% if user.groups.first.name == '–î–∏—Ä–µ–∫—Ç–æ—Ä' %}{% url 'director_tables' %}
                {% elif user.groups.first.name == '–ú–µ–Ω–µ–¥–∂–µ—Ä' %}{% url 'manager_tables' %}
                {% elif user.groups.first.name == '–®–µ—Ñ-–ø–æ–≤–∞—Ä' %}{% url 'chef_tables' %}
                {% elif user.groups.first.name == '–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –∫–∞–¥—Ä–∞–º' %}{% url 'hr_tables' %}
                {% else %}{% url 'dashboard' %}{% endif %}" 
                class="btn btn-outline-secondary">
                ‚Üê –ù–∞–∑–∞–¥ –∫ —Ç–∞–±–ª–∏—Ü–∞–º
            </a>
        </div>
    </div>

    <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="get" class="row g-3">
                <div class="col-md-8">
                    <div class="input-group">
                        <input type="text" name="search" class="form-control" 
                               placeholder="–ü–æ–∏—Å–∫ –ø–æ —Ç–∞–±–ª–∏—Ü–µ..." value="{{ request.GET.search|default:'' }}">
                        <button type="submit" class="btn btn-primary">
                            üîç –ü–æ–∏—Å–∫
                        </button>
                        {% if request.GET.search %}
                        <a href="?" class="btn btn-outline-secondary">–û—á–∏—Å—Ç–∏—Ç—å</a>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="input-group">
                        <select name="per_page" class="form-select" onchange="this.form.submit()">
                            <option value="10" {% if not request.GET.per_page or request.GET.per_page == '10' %}selected{% endif %}>10 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ</option>
                            <option value="20" {% if request.GET.per_page == '20' %}selected{% endif %}>20 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ</option>
                            <option value="50" {% if request.GET.per_page == '50' %}selected{% endif %}>50 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ</option>
                            <option value="100" {% if request.GET.per_page == '100' %}selected{% endif %}>100 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ</option>
                        </select>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ -->
    <div class="card">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th width="50">#</th>
                            {% for field in fields_to_display %}
                            <th>
                                {% with field_name=field %}
                                    {% if field_name == 'name' %}–ù–∞–∑–≤–∞–Ω–∏–µ
                                    {% elif field_name == 'price' %}–¶–µ–Ω–∞
                                    {% elif field_name == 'output' %}–í—ã—Ö–æ–¥
                                    {% elif field_name == 'assortment_group' %}–ì—Ä—É–ø–ø–∞ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–∞
                                    {% elif field_name == 'unit_of_measurement' %}–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è
                                    {% elif field_name == 'gross_weight' %}–í–µ—Å –±—Ä—É—Ç—Ç–æ
                                    {% elif field_name == 'net_weight' %}–í–µ—Å –Ω–µ—Ç—Ç–æ
                                    {% elif field_name == 'purchase_price' %}–ó–∞–∫—É–ø–æ—á–Ω–∞—è —Ü–µ–Ω–∞
                                    {% elif field_name == 'price_premium' %}–ù–∞–¥–±–∞–≤–∫–∞ %
                                    {% elif field_name == 'remaining_stock' %}–û—Å—Ç–∞—Ç–æ–∫
                                    {% elif field_name == 'provider' %}–ü–æ—Å—Ç–∞–≤—â–∏–∫
                                    {% elif field_name == 'director_last_name' %}–§–∞–º–∏–ª–∏—è —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è
                                    {% elif field_name == 'director_first_name' %}–ò–º—è —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è
                                    {% elif field_name == 'abbreviation' %}–ê–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä–∞
                                    {% elif field_name == 'city' %}–ì–æ—Ä–æ–¥
                                    {% elif field_name == 'bank' %}–ë–∞–Ω–∫
                                    {% elif field_name == 'last_name' %}–§–∞–º–∏–ª–∏—è
                                    {% elif field_name == 'first_name' %}–ò–º—è
                                    {% elif field_name == 'middle_name' %}–û—Ç—á–µ—Å—Ç–≤–æ
                                    {% elif field_name == 'position' %}–î–æ–ª–∂–Ω–æ—Å—Ç—å
                                    {% elif field_name == 'gender' %}–ü–æ–ª
                                    {% elif field_name == 'birthday_date' %}–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è
                                    {% elif field_name == 'date' %}–î–∞—Ç–∞
                                    {% elif field_name == 'division' %}–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
                                    {% elif field_name == 'employee' %}–°–æ—Ç—Ä—É–¥–Ω–∏–∫
                                    {% elif field_name == 'event_date' %}–î–∞—Ç–∞ —Å–æ–±—ã—Ç–∏—è
                                    {% elif field_name == 'event_type' %}–¢–∏–ø —Å–æ–±—ã—Ç–∏—è
                                    {% elif field_name == 'place_of_work' %}–ú–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã
                                    {% elif field_name == 'profession' %}–ü—Ä–æ—Ñ–µ—Å—Å–∏—è
                                    {% elif field_name == 'bank_identification_code' %}–ë–ò–ö
                                    {% elif field_name == 'taxpayer_identification_number' %}–ò–ù–ù
                                    {% elif field_name == 'code' %}–ö–æ–¥
                                    {% else %}{{ field_name|title|replace:"_| " }}
                                    {% endif %}
                                {% endwith %}
                            </th>
                            {% endfor %}
                            {% if has_change_permission or has_delete_permission %}
                            <th width="120" class="text-end">–î–µ–π—Å—Ç–≤–∏—è</th>
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for object in object_list %}
                        <tr>
                            <td class="text-muted">{{ forloop.counter0|add:page_obj.start_index }}</td>
                            {% for field in fields_to_display %}
                            <td>
                                {% with value=object|get_attribute:field %}
                                    {% if value|is_foreign_key %}
                                        <span class="text-primary" title="–°–≤—è–∑–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç">
                                            {{ value|truncatechars:30 }}
                                        </span>
                                    {% elif value|is_date %}
                                        {{ value|date:"d.m.Y H:i" }}
                                    {% elif value|is_boolean %}
                                        {% if value %}‚úÖ{% else %}‚ùå{% endif %}
                                    {% elif field == 'image' and value %}
                                        <img src="{{ value.url }}" alt="" style="max-height: 30px;" class="img-thumbnail">
                                    {% elif field == 'price' or field == 'purchase_price' or field == 'price_premium' %}
                                        {{ value }} ‚ÇΩ
                                    {% elif field == 'output' or field == 'gross_weight' or field == 'net_weight' or field == 'remaining_stock' %}
                                        {{ value }}
                                    {% else %}
                                        {{ value|default:"‚Äî"|truncatechars:50 }}
                                    {% endif %}
                                {% endwith %}
                            </td>
                            {% endfor %}
                            {% if has_change_permission or has_delete_permission %}
                            <td class="text-end">
                                <div class="btn-group btn-group-sm">
                                    {% if has_change_permission %}
                                    <a href="{% url 'admin:core_'|add:model_name|add:'_change' object.id %}" 
                                       class="btn btn-outline-warning" title="–ò–∑–º–µ–Ω–∏—Ç—å">
                                        ‚úèÔ∏è
                                    </a>
                                    {% endif %}
                                    {% if has_delete_permission %}
                                    <a href="{% url 'admin:core_'|add:model_name|add:'_delete' object.id %}" 
                                       class="btn btn-outline-danger" title="–£–¥–∞–ª–∏—Ç—å">
                                        üóëÔ∏è
                                    </a>
                                    {% endif %}
                                </div>
                            </td>
                            {% endif %}
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="{{ fields_to_display|length|add:2 }}" class="text-center py-5">
                                <div class="text-muted">
                                    <div class="display-4 mb-3">üì≠</div>
                                    <h5>–¢–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞</h5>
                                    <p>–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
                                    {% if has_add_permission %}
                                    <a href="{% url 'admin:core_'|add:model_name|add:'_add' %}" class="btn btn-primary mt-2">
                                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å
                                    </a>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        {% if page_obj.paginator.num_pages > 1 %}
        <div class="card-footer">
            <nav aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º">
                <ul class="pagination justify-content-center mb-0">
                    {% if page_obj.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.per_page %}&per_page={{ request.GET.per_page }}{% endif %}">
                            ¬´ –ü–µ—Ä–≤–∞—è
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.per_page %}&per_page={{ request.GET.per_page }}{% endif %}">
                            ‚Üê –ù–∞–∑–∞–¥
                        </a>
                    </li>
                    {% endif %}
                    
                    {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                        <li class="page-item active">
                            <span class="page-link">{{ num }}</span>
                        </li>
                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ num }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.per_page %}&per_page={{ request.GET.per_page }}{% endif %}">
                                {{ num }}
                            </a>
                        </li>
                        {% endif %}
                    {% endfor %}
                    
                    {% if page_obj.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.per_page %}&per_page={{ request.GET.per_page }}{% endif %}">
                            –í–ø–µ—Ä–µ–¥ ‚Üí
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.per_page %}&per_page={{ request.GET.per_page }}{% endif %}">
                            –ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª
                        </a>
                    </li>
                    {% endif %}
                </ul>
                <p class="text-center text-muted small mt-2 mb-0">
                    –ü–æ–∫–∞–∑–∞–Ω–æ {{ page_obj.start_index }}‚Äì{{ page_obj.end_index }} –∏–∑ {{ page_obj.paginator.count }} –∑–∞–ø–∏—Å–µ–π
                </p>
            </nav>
        </div>
        {% endif %}
    </div>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∞–≤–∞—Ö -->
    <div class="alert alert-light mt-4">
        <div class="row">
            <div class="col-md-3 text-center">
                <h6>üìã –ü—Ä–æ—Å–º–æ—Ç—Ä</h6>
                <div class="display-6 text-success">
                    ‚úÖ
                </div>
                <small class="text-muted">–†–∞–∑—Ä–µ—à–µ–Ω–æ</small>
            </div>
            <div class="col-md-3 text-center">
                <h6>‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ</h6>
                <div class="display-6 {% if has_add_permission %}text-success{% else %}text-muted{% endif %}">
                    {% if has_add_permission %}‚úÖ{% else %}‚ùå{% endif %}
                </div>
                <small class="text-muted">
                    {% if has_add_permission %}–†–∞–∑—Ä–µ—à–µ–Ω–æ{% else %}–ó–∞–ø—Ä–µ—â–µ–Ω–æ{% endif %}
                </small>
            </div>
            <div class="col-md-3 text-center">
                <h6>‚úèÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ</h6>
                <div class="display-6 {% if has_change_permission %}text-success{% else %}text-muted{% endif %}">
                    {% if has_change_permission %}‚úÖ{% else %}‚ùå{% endif %}
                </div>
                <small class="text-muted">
                    {% if has_change_permission %}–†–∞–∑—Ä–µ—à–µ–Ω–æ{% else %}–ó–∞–ø—Ä–µ—â–µ–Ω–æ{% endif %}
                </small>
            </div>
            <div class="col-md-3 text-center">
                <h6>üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ</h6>
                <div class="display-6 {% if has_delete_permission %}text-success{% else %}text-muted{% endif %}">
                    {% if has_delete_permission %}‚úÖ{% else %}‚ùå{% endif %}
                </div>
                <small class="text-muted">
                    {% if has_delete_permission %}–†–∞–∑—Ä–µ—à–µ–Ω–æ{% else %}–ó–∞–ø—Ä–µ—â–µ–Ω–æ{% endif %}
                </small>
            </div>
        </div>
    </div>

    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-3">
        <a href="{% url 'dashboard' %}" class="btn btn-secondary">
            ‚Üê –ù–∞–∑–∞–¥ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        </a>
        {% if user.is_staff %}
        <a href="{% url 'admin:index' %}" class="btn btn-outline-primary">
            ‚öôÔ∏è –ü–µ—Ä–µ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω–∫—É
        </a>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// –í–∫–ª—é—á–µ–Ω–∏–µ tooltip'–æ–≤
document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
    
    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å—Ç—Ä–æ–∫ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
    const tableRows = document.querySelectorAll('tbody tr');
    tableRows.forEach(row => {
        row.addEventListener('mouseenter', function() {
            this.style.backgroundColor = '#f8f9fa';
        });
        row.addEventListener('mouseleave', function() {
            this.style.backgroundColor = '';
        });
    });
});
</script>
{% endblock %}